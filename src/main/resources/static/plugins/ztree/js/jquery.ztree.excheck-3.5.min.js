(function(p){var r={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},w={check:{enable:!1,autoCheckTrigger:!1,chkStyle:r.checkbox.STYLE,nocheckInherit:!1,chkDisabledInherit:!1,radioType:r.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},x=function(c,a){if(!0===a.chkDisabled)return!1;var b=f.getSetting(c.data.treeId),d=b.data.key.checked;if(0==m.apply(b.callback.beforeCheck,[b.treeId,a],!0))return!0;a[d]=!a[d];e.checkNodeRelation(b,a);d=q(a,l.id.CHECK,b);e.setChkClass(b,d,a);e.repairParentChkClassWithSelf(b,a);b.treeObj.trigger(l.event.CHECK,[c,b.treeId,a]);return!0},y=function(c,a){if(!0===a.chkDisabled)return!1;var b=f.getSetting(c.data.treeId),d=q(a,l.id.CHECK,b);a.check_Focus=!0;e.setChkClass(b,d,a);return!0},z=function(c,a){if(!0===a.chkDisabled)return!1;var b=f.getSetting(c.data.treeId),d=q(a,l.id.CHECK,b);a.check_Focus=!1;e.setChkClass(b,d,a);return!0};p.extend(!0,p.fn.zTree.consts,r);p.extend(!0,p.fn.zTree._z,{tools:{},view:{checkNodeRelation:function(c,a){var b,d,h,k=c.data.key.children,n=c.data.key.checked;b=l.radio;if(c.check.chkStyle==b.STYLE){var g=f.getRadioCheckedList(c);if(a[n])if(c.check.radioType==b.TYPE_ALL){for(d=g.length-1;0<=d;d--)b=g[d],b[n]&&b!=a&&(b[n]=!1,g.splice(d,1),e.setChkClass(c,q(b,l.id.CHECK,c),b),b.parentTId!=a.parentTId&&e.repairParentChkClassWithSelf(c,b));g.push(a)}else for(g=a.parentTId?a.getParentNode():f.getRoot(c),d=0,h=g[k].length;d<h;d++)b=g[k][d],b[n]&&b!=a&&(b[n]=!1,e.setChkClass(c,q(b,l.id.CHECK,c),b));else if(c.check.radioType==b.TYPE_ALL)for(d=0,h=g.length;d<h;d++)if(a==g[d]){g.splice(d,1);break}}else a[n]&&(!a[k]||0==a[k].length||-1<c.check.chkboxType.Y.indexOf("s"))&&e.setSonNodeCheckBox(c,a,!0),a[n]||a[k]&&0!=a[k].length&&!(-1<c.check.chkboxType.N.indexOf("s"))||e.setSonNodeCheckBox(c,a,!1),a[n]&&-1<c.check.chkboxType.Y.indexOf("p")&&e.setParentNodeCheckBox(c,a,!0),!a[n]&&-1<c.check.chkboxType.N.indexOf("p")&&e.setParentNodeCheckBox(c,a,!1)},makeChkClass:function(c,a){var b=c.data.key.checked,d=l.checkbox,h=l.radio,k="",k=!0===a.chkDisabled?d.DISABLED:a.halfCheck?d.PART:c.check.chkStyle==h.STYLE?1>a.check_Child_State?d.FULL:d.PART:a[b]?2===a.check_Child_State||-1===a.check_Child_State?d.FULL:d.PART:1>a.check_Child_State?d.FULL:d.PART,b=c.check.chkStyle+"_"+(a[b]?d.TRUE:d.FALSE)+"_"+k,b=a.check_Focus&&!0!==a.chkDisabled?b+"_"+d.FOCUS:b;return l.className.BUTTON+" "+d.DEFAULT+" "+b},repairAllChk:function(c,a){if(c.check.enable&&c.check.chkStyle===l.checkbox.STYLE)for(var b=c.data.key.checked,d=c.data.key.children,h=f.getRoot(c),k=0,n=h[d].length;k<n;k++){var g=h[d][k];!0!==g.nocheck&&!0!==g.chkDisabled&&(g[b]=a);e.setSonNodeCheckBox(c,g,a)}},repairChkClass:function(c,a){if(a&&(f.makeChkFlag(c,a),!0!==a.nocheck)){var b=q(a,l.id.CHECK,c);e.setChkClass(c,b,a)}},repairParentChkClass:function(c,a){if(a&&a.parentTId){var b=a.getParentNode();e.repairChkClass(c,b);e.repairParentChkClass(c,b)}},repairParentChkClassWithSelf:function(c,a){if(a){var b=c.data.key.children;a[b]&&0<a[b].length?e.repairParentChkClass(c,a[b][0]):e.repairParentChkClass(c,a)}},repairSonChkDisabled:function(c,a,b,d){if(a){var h=c.data.key.children;a.chkDisabled!=b&&(a.chkDisabled=b);e.repairChkClass(c,a);if(a[h]&&d)for(var k=0,n=a[h].length;k<n;k++)e.repairSonChkDisabled(c,a[h][k],b,d)}},repairParentChkDisabled:function(c,a,b,d){a&&(a.chkDisabled!=b&&d&&(a.chkDisabled=b),e.repairChkClass(c,a),e.repairParentChkDisabled(c,a.getParentNode(),b,d))},setChkClass:function(c,a,b){a&&(!0===b.nocheck?a.hide():a.show(),a.attr("class",e.makeChkClass(c,b)))},setParentNodeCheckBox:function(c,a,b,d){var h=c.data.key.children,k=c.data.key.checked,n=q(a,l.id.CHECK,c);d||(d=a);f.makeChkFlag(c,a);!0!==a.nocheck&&!0!==a.chkDisabled&&(a[k]=b,e.setChkClass(c,n,a),c.check.autoCheckTrigger&&a!=d&&c.treeObj.trigger(l.event.CHECK,[null,c.treeId,a]));if(a.parentTId){n=!0;if(!b)for(var h=a.getParentNode()[h],g=0,m=h.length;g<m;g++)if(!0!==h[g].nocheck&&!0!==h[g].chkDisabled&&h[g][k]||(!0===h[g].nocheck||!0===h[g].chkDisabled)&&0<h[g].check_Child_State){n=!1;break}n&&e.setParentNodeCheckBox(c,a.getParentNode(),b,d)}},setSonNodeCheckBox:function(c,a,b,d){if(a){var h=c.data.key.children,k=c.data.key.checked,n=q(a,l.id.CHECK,c);d||(d=a);var g=!1;if(a[h])for(var m=0,p=a[h].length;m<p&&!0!==a.chkDisabled;m++){var r=a[h][m];e.setSonNodeCheckBox(c,r,b,d);!0===r.chkDisabled&&(g=!0)}a!=f.getRoot(c)&&!0!==a.chkDisabled&&(g&&!0!==a.nocheck&&f.makeChkFlag(c,a),!0!==a.nocheck&&!0!==a.chkDisabled?(a[k]=b,g||(a.check_Child_State=a[h]&&0<a[h].length?b?2:0:-1)):a.check_Child_State=-1,e.setChkClass(c,n,a),c.check.autoCheckTrigger&&a!=d&&!0!==a.nocheck&&!0!==a.chkDisabled&&c.treeObj.trigger(l.event.CHECK,[null,c.treeId,a]))}}},event:{},data:{getRadioCheckedList:function(c){for(var a=f.getRoot(c).radioCheckedList,b=0,d=a.length;b<d;b++)f.getNodeCache(c,a[b].tId)||(a.splice(b,1),b--,d--);return a},getCheckStatus:function(c,a){if(!c.check.enable||a.nocheck||a.chkDisabled)return null;var b=c.data.key.checked;return{checked:a[b],half:a.halfCheck?a.halfCheck:c.check.chkStyle==l.radio.STYLE?2===a.check_Child_State:a[b]?-1<a.check_Child_State&&2>a.check_Child_State:0<a.check_Child_State}},getTreeCheckedNodes:function(c,a,b,d){if(!a)return[];var h=c.data.key.children,k=c.data.key.checked,e=b&&c.check.chkStyle==l.radio.STYLE&&c.check.radioType==l.radio.TYPE_ALL;d=d?d:[];for(var g=0,m=a.length;g<m&&(!0===a[g].nocheck||!0===a[g].chkDisabled||a[g][k]!=b||(d.push(a[g]),!e))&&!(f.getTreeCheckedNodes(c,a[g][h],b,d),e&&0<d.length);g++);return d},getTreeChangeCheckedNodes:function(c,a,b){if(!a)return[];var d=c.data.key.children,h=c.data.key.checked;b=b?b:[];for(var k=0,e=a.length;k<e;k++)!0!==a[k].nocheck&&!0!==a[k].chkDisabled&&a[k][h]!=a[k].checkedOld&&b.push(a[k]),f.getTreeChangeCheckedNodes(c,a[k][d],b);return b},makeChkFlag:function(c,a){if(a){var b=c.data.key.children,d=c.data.key.checked,h=-1;if(a[b])for(var k=0,e=a[b].length;k<e;k++){var g=a[b][k],f=-1;if(c.check.chkStyle==l.radio.STYLE)if(f=!0===g.nocheck||!0===g.chkDisabled?g.check_Child_State:!0===g.halfCheck?2:g[d]?2:0<g.check_Child_State?2:0,2==f){h=2;break}else 0==f&&(h=0);else if(c.check.chkStyle==l.checkbox.STYLE)if(f=!0===g.nocheck||!0===g.chkDisabled?g.check_Child_State:!0===g.halfCheck?1:g[d]?-1===g.check_Child_State||2===g.check_Child_State?2:1:0<g.check_Child_State?1:0,1===f){h=1;break}else if(2===f&&-1<h&&0<k&&f!==h){h=1;break}else if(2===h&&-1<f&&2>f){h=1;break}else-1<f&&(h=f)}a.check_Child_State=h}}}});p=p.fn.zTree;var m=p._z.tools,l=p.consts,e=p._z.view,f=p._z.data,q=m.$;f.exSetting(w);f.addInitBind(function(c){c.treeObj.bind(l.event.CHECK,function(a,b,d,h){a.srcEvent=b;m.apply(c.callback.onCheck,[a,d,h])})});f.addInitUnBind(function(c){c.treeObj.unbind(l.event.CHECK)});f.addInitCache(function(c){});f.addInitNode(function(c,a,b,d,h,e,n){b&&(a=c.data.key.checked,"string"==typeof b[a]&&(b[a]=m.eqs(b[a],"true")),b[a]=!!b[a],b.checkedOld=b[a],"string"==typeof b.nocheck&&(b.nocheck=m.eqs(b.nocheck,"true")),b.nocheck=!!b.nocheck||c.check.nocheckInherit&&d&&!!d.nocheck,"string"==typeof b.chkDisabled&&(b.chkDisabled=m.eqs(b.chkDisabled,"true")),b.chkDisabled=!!b.chkDisabled||c.check.chkDisabledInherit&&d&&!!d.chkDisabled,"string"==typeof b.halfCheck&&(b.halfCheck=m.eqs(b.halfCheck,"true")),b.halfCheck=!!b.halfCheck,b.check_Child_State=-1,b.check_Focus=!1,b.getCheckStatus=function(){return f.getCheckStatus(c,b)},c.check.chkStyle==l.radio.STYLE&&c.check.radioType==l.radio.TYPE_ALL&&b[a]&&f.getRoot(c).radioCheckedList.push(b))});f.addInitProxy(function(c){var a=c.target,b=f.getSetting(c.data.treeId),d="",h=null,e="",n=null;m.eqs(c.type,"mouseover")?b.check.enable&&m.eqs(a.tagName,"span")&&null!==a.getAttribute("treeNode"+l.id.CHECK)&&(d=m.getNodeMainDom(a).id,e="mouseoverCheck"):m.eqs(c.type,"mouseout")?b.check.enable&&m.eqs(a.tagName,"span")&&null!==a.getAttribute("treeNode"+l.id.CHECK)&&(d=m.getNodeMainDom(a).id,e="mouseoutCheck"):m.eqs(c.type,"click")&&b.check.enable&&m.eqs(a.tagName,"span")&&null!==a.getAttribute("treeNode"+l.id.CHECK)&&(d=m.getNodeMainDom(a).id,e="checkNode");if(0<d.length)switch(h=f.getNodeCache(b,d),e){case "checkNode":n=x;break;case "mouseoverCheck":n=y;break;case "mouseoutCheck":n=z}return{stop:"checkNode"===e,node:h,nodeEventType:e,nodeEventCallback:n,treeEventType:"",treeEventCallback:null}},!0);f.addInitRoot(function(c){f.getRoot(c).radioCheckedList=[]});f.addBeforeA(function(c,a,b){c.check.enable&&(f.makeChkFlag(c,a),b.push("\x3cspan ID\x3d'",a.tId,l.id.CHECK,"' class\x3d'",e.makeChkClass(c,a),"' treeNode",l.id.CHECK,!0===a.nocheck?" style\x3d'display:none;'":"","\x3e\x3c/span\x3e"))});f.addZTreeTools(function(c,a){a.checkNode=function(a,b,c,f){var g=this.setting.data.key.checked;!0!==a.chkDisabled&&(!0!==b&&!1!==b&&(b=!a[g]),f=!!f,a[g]===b&&!c||f&&0==m.apply(this.setting.callback.beforeCheck,[this.setting.treeId,a],!0)||!m.uCanDo(this.setting)||!this.setting.check.enable||!0===a.nocheck||(a[g]=b,b=q(a,l.id.CHECK,this.setting),(c||this.setting.check.chkStyle===l.radio.STYLE)&&e.checkNodeRelation(this.setting,a),e.setChkClass(this.setting,b,a),e.repairParentChkClassWithSelf(this.setting,a),f&&this.setting.treeObj.trigger(l.event.CHECK,[null,this.setting.treeId,a])))};a.checkAllNodes=function(a){e.repairAllChk(this.setting,!!a)};a.getCheckedNodes=function(a){var b=this.setting.data.key.children;a=!1!==a;return f.getTreeCheckedNodes(this.setting,f.getRoot(this.setting)[b],a)};a.getChangeCheckedNodes=function(){var a=this.setting.data.key.children;return f.getTreeChangeCheckedNodes(this.setting,f.getRoot(this.setting)[a])};a.setChkDisabled=function(a,b,c,f){b=!!b;c=!!c;e.repairSonChkDisabled(this.setting,a,b,!!f);e.repairParentChkDisabled(this.setting,a.getParentNode(),b,c)};var b=a.updateNode;a.updateNode=function(c,f){b&&b.apply(a,arguments);if(c&&this.setting.check.enable&&q(c,this.setting).get(0)&&m.uCanDo(this.setting)){var k=q(c,l.id.CHECK,this.setting);1!=f&&this.setting.check.chkStyle!==l.radio.STYLE||e.checkNodeRelation(this.setting,c);e.setChkClass(this.setting,k,c);e.repairParentChkClassWithSelf(this.setting,c)}}});var t=e.createNodes;e.createNodes=function(c,a,b,d){t&&t.apply(e,arguments);b&&e.repairParentChkClassWithSelf(c,d)};var u=e.removeNode;e.removeNode=function(c,a){var b=a.getParentNode();u&&u.apply(e,arguments);a&&b&&(e.repairChkClass(c,b),e.repairParentChkClass(c,b))};var v=e.appendNodes;e.appendNodes=function(c,a,b,d,h,k){var l="";v&&(l=v.apply(e,arguments));d&&f.makeChkFlag(c,d);return l}})(jQuery);